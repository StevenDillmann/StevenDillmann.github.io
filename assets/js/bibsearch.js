import{highlightSearchTerm}from"./highlight-search-term.js";document.addEventListener("DOMContentLoaded",(function(){function e(){const e=t.querySelectorAll(".keyword-tag");e.forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=this.textContent.replace("#","").trim(),o=document.querySelectorAll(".filter-keyword-tag");let l=!1;o.forEach((e=>{e.textContent.trim()===t&&(e.click(),l=!0)}))}))}))}const t=document.querySelector(".publications")||document,o=()=>{const e=new Set;return t.querySelectorAll(".keywords .keyword-tag").forEach((t=>{const o=t.textContent.replace("#","").trim();o&&e.add(o)})),Array.from(e).sort()},l=()=>{const e=o(),t=document.getElementById("keyword-filter-container");0!==e.length?(t.innerHTML="",e.forEach((e=>{const o=document.createElement("span");o.className="filter-keyword-tag",o.textContent=e,o.onclick=()=>n(e),t.appendChild(o)}))):t.innerHTML="<p>No keywords found in publications.</p>"},n=e=>{const t=Array.from(document.querySelectorAll(".filter-keyword-tag")).find((t=>t.textContent===e));t&&(t.classList.toggle("active"),r())},r=()=>{const e=Array.from(document.querySelectorAll(".filter-keyword-tag.active")).map((e=>e.textContent));t.querySelectorAll(".bibliography > li").forEach((t=>{const o=Array.from(t.querySelectorAll(".keywords .keyword-tag")).map((e=>e.textContent.replace("#","").trim()));if(0===e.length)t.classList.remove("unloaded");else{e.some((e=>o.includes(e)))?t.classList.remove("unloaded"):t.classList.add("unloaded")}})),t.querySelectorAll("h2.bibliography").forEach((function(e){let t=e.nextElementSibling,o=!0;for(;t&&"H2"!==t.tagName;){if("OL"===t.tagName){const e=t,l=e.querySelectorAll(":scope > li.unloaded"),n=e.querySelectorAll(":scope > li");l.length===n.length?(e.previousElementSibling.classList.add("unloaded"),e.classList.add("unloaded")):o=!1}t=t.nextElementSibling}o&&e.classList.add("unloaded")}))};document.getElementById("clear-keyword-filters").onclick=()=>{document.querySelectorAll(".filter-keyword-tag").forEach((e=>{e.classList.remove("active")}));document.getElementById("bibsearch").value="",CSS.highlights&&CSS.highlights.clear(),t.querySelectorAll(".highlighted").forEach((e=>{e.classList.remove("highlighted")})),t.querySelectorAll(".bibliography > li, .unloaded").forEach((e=>{e.classList.remove("unloaded")})),t.querySelectorAll("h2.bibliography, h3.bibliography").forEach((e=>{e.classList.remove("unloaded")})),t.querySelectorAll("ol").forEach((e=>{e.classList.remove("unloaded")}))},l(),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".research-interest").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=this.getAttribute("data-keyword");window.location.href="/publications/?filter="+encodeURIComponent(t)}))}))})),document.addEventListener("DOMContentLoaded",e);const i=e=>{if(t.querySelectorAll(".bibliography, .unloaded").forEach((e=>e.classList.remove("unloaded"))),CSS.highlights){const t=highlightSearchTerm({search:e,selector:".bibliography > li"});if(null==t)return;t.forEach((e=>{e.classList.add("unloaded")}))}else t.querySelectorAll(".bibliography > li").forEach((t=>{-1==t.innerText.toLowerCase().indexOf(e)&&t.classList.add("unloaded")}));t.querySelectorAll("h2.bibliography").forEach((function(e){let t=e.nextElementSibling,o=!0;for(;t&&"H2"!==t.tagName;){if("OL"===t.tagName){const e=t,l=e.querySelectorAll(":scope > li.unloaded"),n=e.querySelectorAll(":scope > li");l.length===n.length?(e.previousElementSibling.classList.add("unloaded"),e.classList.add("unloaded")):o=!1}t=t.nextElementSibling}o&&e.classList.add("unloaded")}))},a=()=>{const e=decodeURIComponent(window.location.hash.substring(1));document.getElementById("bibsearch").value=e,i(e)};let c;document.getElementById("bibsearch").addEventListener("input",(function(){clearTimeout(c);const e=this.value.toLowerCase();c=setTimeout((()=>{i(e),r()}),300)})),window.addEventListener("hashchange",a),setTimeout((()=>{const e=new URLSearchParams(window.location.search).get("filter");if(e){const t=document.querySelectorAll(".filter-keyword-tag");let o=!1;t.forEach((t=>{t.textContent.trim().toLowerCase()===e.toLowerCase()&&(t.click(),o=!0)})),o||t.forEach((t=>{t.textContent.trim().toLowerCase().includes(e.toLowerCase())&&t.click()}))}}),500),a()}));